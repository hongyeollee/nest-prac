<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ… WebSocket í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, button {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .message {
            padding: 5px;
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        .server-message {
            color: #2196F3;
            font-weight: bold;
        }
        .error-message {
            color: #f44336;
            font-weight: bold;
        }
        .status {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .connected {
            background-color: #d4edda;
            color: #155724;
        }
        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
        .config-section {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ì±„íŒ… WebSocket í…ŒìŠ¤íŠ¸</h1>

        <div id="status" class="status disconnected">
            ì—°ê²° ì•ˆë¨
        </div>

        <div class="config-section">
            <h3>âš™ï¸ ì—°ê²° ì„¤ì •</h3>
            <div class="input-group">
                <label>ì„œë²„ í¬íŠ¸:</label>
                <input type="number" id="port" placeholder="3001" value="3001">
            </div>
            <div class="input-group">
                <label>JWT í† í°:</label>
                <input type="text" id="token" placeholder="ì—¬ê¸°ì— JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
        </div>

        <button id="connectBtn" onclick="connect()">ì—°ê²°</button>
        <button id="disconnectBtn" onclick="disconnect()" disabled>ì—°ê²° í•´ì œ</button>

        <hr>

        <h3>ë°© ì…ì¥/í‡´ì¥</h3>
        <div class="input-group">
            <label>ë°© ID:</label>
            <input type="number" id="roomId" placeholder="1" value="1">
        </div>
        <button onclick="joinRoom()">ë°© ì…ì¥</button>
        <button onclick="leaveRoom()">ë°© í‡´ì¥</button>

        <hr>

        <h3>ë©”ì‹œì§€ ì „ì†¡</h3>
        <div class="input-group">
            <label>ë©”ì‹œì§€:</label>
            <textarea id="message" rows="3" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
        <button onclick="sendMessage()">ë©”ì‹œì§€ ì „ì†¡</button>

        <hr>

        <h3>íƒ€ì´í•‘ ìƒíƒœ</h3>
        <button onclick="startTyping()">íƒ€ì´í•‘ ì‹œì‘</button>
        <button onclick="stopTyping()">íƒ€ì´í•‘ ì¤‘ì§€</button>

        <hr>

        <h3>ğŸ“¨ ìˆ˜ì‹  ë©”ì‹œì§€</h3>
        <button onclick="clearMessages()" style="background-color: #ff9800; margin-bottom: 10px;">ë©”ì‹œì§€ ì§€ìš°ê¸°</button>
        <div id="messages"></div>
    </div>

    <script>
        let socket = null;

        function connect() {
            const token = document.getElementById('token').value;
            const port = document.getElementById('port').value;

            if (!token) {
                alert('JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }

            if (!port) {
                alert('í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }

            addMessage(`ğŸ”Œ ì„œë²„ ì—°ê²° ì‹œë„ ì¤‘... (http://localhost:${port}/chat)`, 'server-message');

            socket = io(`http://localhost:${port}/chat`, {
                auth: {
                    token: token
                },
                transports: ['websocket', 'polling']
            });

            socket.on('connect', () => {
                addMessage('âœ… ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤', 'server-message');
                updateStatus(true);
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('disconnectBtn').disabled = false;
            });

            socket.on('connect_error', (error) => {
                addMessage(`âŒ ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error-message');
                addMessage('ğŸ’¡ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€, í¬íŠ¸ ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”', 'error-message');
                updateStatus(false);
            });

            socket.on('disconnect', () => {
                addMessage('âŒ ì„œë²„ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤', 'error-message');
                updateStatus(false);
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('disconnectBtn').disabled = true;
            });

            socket.on('joinedRoom', (data) => {
                addMessage(`ğŸšª ë°© ${data.roomId}ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤`, 'server-message');
            });

            socket.on('leftRoom', (data) => {
                addMessage(`ğŸšª ë°© ${data.roomId}ì—ì„œ í‡´ì¥í–ˆìŠµë‹ˆë‹¤`, 'server-message');
            });

            socket.on('messageCreated', (data) => {
                addMessage(`ğŸ’¬ ìƒˆ ë©”ì‹œì§€: "${data.content}" (ë°œì‹ ì: ${data.senderUserUuid})`, 'server-message');
            });

            socket.on('typing', (data) => {
                const status = data.isTyping ? 'ì…ë ¥ ì¤‘...' : 'ì…ë ¥ ì¤‘ì§€';
                addMessage(`âŒ¨ï¸ ${data.userUuid}ë‹˜ì´ ${status}`, 'server-message');
            });

            socket.on('readUpdated', (data) => {
                addMessage(`âœ… ${data.userUuid}ë‹˜ì´ ë©”ì‹œì§€ ${data.messageId}ê¹Œì§€ ì½ìŒ`, 'server-message');
            });

            socket.on('error', (error) => {
                addMessage(`âŒ ì—ëŸ¬: ${JSON.stringify(error)}`, 'error-message');
            });

            socket.on('exception', (error) => {
                addMessage(`âŒ ì˜ˆì™¸ ë°œìƒ: ${JSON.stringify(error)}`, 'error-message');
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('disconnectBtn').disabled = true;
                updateStatus(false);
            }
        }

        function joinRoom() {
            if (!socket) {
                alert('ë¨¼ì € ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”');
                return;
            }
            const roomId = parseInt(document.getElementById('roomId').value);
            addMessage(`ğŸ“¤ ë°© ${roomId} ì…ì¥ ìš”ì²­...`, 'server-message');
            socket.emit('joinOrLeftRoom', { roomId, action: 'join' }, (response) => {
                addMessage(`ğŸ“¥ ì‘ë‹µ: ${response}`, 'server-message');
            });
        }

        function leaveRoom() {
            if (!socket) {
                alert('ë¨¼ì € ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”');
                return;
            }
            const roomId = parseInt(document.getElementById('roomId').value);
            addMessage(`ğŸ“¤ ë°© ${roomId} í‡´ì¥ ìš”ì²­...`, 'server-message');
            socket.emit('joinOrLeftRoom', { roomId, action: 'leave' }, (response) => {
                addMessage(`ğŸ“¥ ì‘ë‹µ: ${response}`, 'server-message');
            });
        }

        function sendMessage() {
            if (!socket) {
                alert('ë¨¼ì € ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”');
                return;
            }
            const roomId = parseInt(document.getElementById('roomId').value);
            const content = document.getElementById('message').value;

            if (!content) {
                alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }

            addMessage(`ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡: "${content}"`, 'server-message');
            socket.emit('sendMessage', { roomId, content }, (response) => {
                addMessage(`ğŸ“¥ ì „ì†¡ ì™„ë£Œ: ${JSON.stringify(response)}`, 'server-message');
                document.getElementById('message').value = '';
            });
        }

        function startTyping() {
            if (!socket) {
                alert('ë¨¼ì € ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”');
                return;
            }
            const roomId = parseInt(document.getElementById('roomId').value);
            socket.emit('typing', { roomId, isTyping: true });
            addMessage('âŒ¨ï¸ íƒ€ì´í•‘ ìƒíƒœ ì „ì†¡: true', 'server-message');
        }

        function stopTyping() {
            if (!socket) {
                alert('ë¨¼ì € ì„œë²„ì— ì—°ê²°í•˜ì„¸ìš”');
                return;
            }
            const roomId = parseInt(document.getElementById('roomId').value);
            socket.emit('typing', { roomId, isTyping: false });
            addMessage('âŒ¨ï¸ íƒ€ì´í•‘ ìƒíƒœ ì „ì†¡: false', 'server-message');
        }

        function addMessage(text, className = '') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            messageDiv.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
            addMessage('ğŸ—‘ï¸ ë©”ì‹œì§€ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤', 'server-message');
        }

        function updateStatus(connected) {
            const statusDiv = document.getElementById('status');
            if (connected) {
                statusDiv.className = 'status connected';
                statusDiv.textContent = 'âœ… ì—°ê²°ë¨';
            } else {
                statusDiv.className = 'status disconnected';
                statusDiv.textContent = 'âŒ ì—°ê²° ì•ˆë¨';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´ ë©”ì‹œì§€
        window.onload = function() {
            addMessage('ğŸ‘‹ WebSocket í…ŒìŠ¤íŠ¸ í˜ì´ì§€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!', 'server-message');
            addMessage('1ï¸âƒ£ ë¨¼ì € Swaggerì—ì„œ ë¡œê·¸ì¸í•˜ì—¬ JWT í† í°ì„ ë°›ìœ¼ì„¸ìš”', 'server-message');
            addMessage('2ï¸âƒ£ ì„œë²„ í¬íŠ¸ì™€ JWT í† í°ì„ ì…ë ¥í•˜ê³  "ì—°ê²°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”', 'server-message');
            addMessage('3ï¸âƒ£ ì±„íŒ…ë°©ì„ ìƒì„±í•˜ê³  ë°© IDë¥¼ ì…ë ¥í•œ í›„ "ë°© ì…ì¥"ì„ í´ë¦­í•˜ì„¸ìš”', 'server-message');
        };
    </script>
</body>
</html>
